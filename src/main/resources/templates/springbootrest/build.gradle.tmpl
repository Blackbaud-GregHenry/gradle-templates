buildscript {
    ext {
        springBootVersion = '1.2.3.RELEASE'
    }
    repositories {
        mavenLocal()
        maven {
            url "http://nexus.conviocloud.com/content/groups/public"
        }
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath "com.blackbaud:gradle-internal:1+"
        classpath "com.blackbaud:gradle-docker:1.1+"
    }
}

apply plugin: "blackbaud-internal"
apply plugin: "docker"
apply plugin: 'spring-boot'
apply plugin: 'pmd'

compileJava {
    sourceCompatibility = 1.8
    targetCompatibility = 1.8
}

/**
 * This defines all of the repositories that will be used to download the dependencies.
 */
repositories {
    mavenLocal()
    maven {
        url "http://nexus.conviocloud.com/content/groups/public"
    }
}

configurations {
    client
}

sourceSets {
    client {
        java {
            srcDir "src/main/java"
            include "com/blackbaud/template/api/**"
            include "com/blackbaud/template/client/**"
        }
    }
}

dependencies {
    compile("org.springframework.boot:spring-boot-starter-web")
    compile("org.springframework.boot:spring-boot-starter-actuator")
    compile("org.springframework.boot:spring-boot-starter-data-jpa")
    compile("org.springframework.boot:spring-boot-starter-jersey")
    compile("org.springframework.boot:spring-boot-starter-security")

    compile 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.4.0'

    // HSQLDB for embedded database support
    //compile("org.hsqldb:hsqldb")
    //compile 'com.oracle.jdbc:ojdbc6:11.2.0.3'
    // the following brings in an incompatible slf4j dependency
    //compile 'org.postgresql:postgresql:9.4-1200-jdbc41'
    compile 'postgresql:postgresql:9.0-801.jdbc4'

    compile 'org.liquibase:liquibase-core'

    // Utilities
    compile("com.google.guava:guava:18.0")
    compile 'org.projectlombok:lombok:1.16.4'
    compile('net.sf.dozer:dozer:5.5.1') {
        exclude group: 'org.slf4j'
    }

    clientCompile 'org.projectlombok:lombok:1.16.4'
    clientCompile("org.springframework.boot:spring-boot-starter-web")
    clientCompile("org.springframework.boot:spring-boot-starter-jersey")

    mainTestCompile 'org.codehaus.groovy:groovy-all:2.4.3'
    mainTestCompile 'org.fluttercode.datafactory:datafactory:0.8'
    testCompile 'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
    testCompile ('org.spockframework:spock-spring:1.0-groovy-2.4') {
        exclude group: 'org.codehaus.groovy'
    }
    testCompile "org.springframework.boot:spring-boot-starter-test"
    testCompile "commons-io:commons-io:2.4"
}

publishing_ext {
    publication('mainTest')
    publication('client')
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.3'
}

docker {
    container {
        imageName "postgres:9.4"
        publish "5432:5432"
        env "POSTGRES_USER=changeme"
        env "POSTGRES_PASSWORD=changeme"
    }
}